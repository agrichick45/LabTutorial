---
title: "Tutorial"
author: "Mandy Liesch"
date: "2025-06-18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tigris)
library(tidyverse)
library(terra)
library(tidyterra)

```
## Shapefiles

The tigris package allows for the downloading of spatial data at several geographic scales, including states and counties (shown here). There are 3233 county polygons and 9 data fields in the intial tigris file. However, the state vector (using State FIPS), narrows the states to ones that are in the Mississippi/Ohio River Basin. We are looking at a 12 state area that make up the bulk of these basins

```{r}
#Create a vector with the state FIPS that we need to extract. 
states<-c("5", "17", "18", "19", "21", "22", "27","28",  "29", "39", "47", "55")

#Use the tigris package, and get the counties extracted by the state we specificied
#in the states vector
counties_raw <- tigris::counties(states,
  #add the county boundaries
  cb = TRUE,
  #specify the resolution (we don't need the highest one)
  resolution = "500k",
  #Pick the year the county files are extracted
  year = 2019,
  #specify the data type
  class = "sf"
)

#Check the metadata information
counties_raw 

```

The polygon file has several important attributes, as well as columns of data associated with each county file (shapefile). There are 1091 counties, with 9 different geographic fields. 

Bounding box limits the geographic area. The Geodetic CRS is very important information when we are dealing with spatial data. IF you are combining or layering information, this value must be the same in both sources, or projections will not line up. The NAD83 is very common for US Datasets.  

Columns include the State FIP value and the county FIP values, as well as the combined GEOID, County Name, Area of Land, water and the Geometry attributes. We do not need the extra values, so we can remove all of the extra columns, except for GEOID and the county NAME. 

```{r}
#Select the columns needed for geographic data
counties <- counties_raw %>%  
  #Choosing the GEOID to pair with datasets and the county Names
  select(GEOID, NAME)

#Convert data file into a spatVector
counties<- vect(counties)

#plot the counties to check the geographic area
plot(counties)

```

When you use the plot function in base R, it will plot every column as a unique plot, in this case, we will get 2 of these plots. Changing the values into a spatvector using the Terra package shows only one shapefile, and removes the geometries as a column. This also allows the setup to use values in ggplot at a later time. 


## Ancillary Data

Most of these shapefiles can be merged with datafiles and spreadsheets to expand and visualize anything with data. A majority of this federally based data is classified by State code (two numbers) and county code (three numbers). These are combined together to create a GEOID (or FIPS).  For example, the State of Wisconsin has a state code of 55, and each county has its own number, Outagamie County, WI, for example, is county 087, giving it an idenity of 55087. 

Almost all federal agencies have large respositories of data that anyone can access, via downloads of spreadsheet files (or .csv) that can be used for mapping with shapefiles. 

[Atlas of Rural Towns (USDA ERS)](https://www.ers.usda.gov/data-products/atlas-of-rural-and-small-town-america): 

[USDA ERS Data](https://www.ers.usda.gov/data-products)

[CDC Wonder](https://wonder.cdc.gov/): 

[National Agricultural Statistics Service](https://quickstats.nass.usda.gov/): 

[Census Bureau](https://www.census.gov/data.html): 

[Bureau of Labor Statistics](https://www.bls.gov/data/):

[NRCS Geospatial Data Gateway](https://datagateway.nrcs.usda.gov/):

## Datafile

For these shapefiles, we are utilizing a .csv file that was curated from the NASS database from the 2017 Agricultural Census for states on the Mississippi River Basin. 

```{r}
#Load the data frame
NASS2017<-read.csv("NASS2017_Snapshot.csv")

#Observe the data
View(NASS2017)

NASS2017$FIPS<-sprintf("%05d", NASS2017$FIPS)

```

There are 1,090 counties in this area, and 27 columns of data involving crop and agricultural production data. 

FIPS: Federal code identifying counties
Market_Value: Total Agricultural Market Value in the County in dollars
Per_Crop_sales: Percentage of Agricultural Income Generated by Crop Production
Per_Grain_Mark_Val:  Percentage of Agricultural Income Generated by grain crops (Corn, soybean, etc.)
Per_Cotton_Mark_Val:  Percentage of Agricultural Income Generated by cotton
Per_Other_Crop_Mark_Val: Percentage of Agricultural Income Generated by other crops (like oil crops, hops, etc)
Per_Veg_Sale_Mkt_Val: Percentage of Agricultural Income Generated by vegetables (carrots, cabbage, etc)
Per_Fruit_Sales_Mkt_Val: Percentage of Agricultural Income Generated by fruits (melons, cranberries, blueberries, etc)
Per_Nursery_Sales_Val:  Percentage of Agricultural Income Generated by nursery crops
Per_Cut_Tree_Sales_Val:  Percentage of Agricultural Income Generated by cut trees
Per_Ani_Sales_Mark_Val: Percentage of Agricultural Income Generated by Animal Production
Per_Poul_Sales_Mark_Val: Percentage of Agricultural Income Generated by Poultry Production (Turkey, Broilers, Eggs, etc.)
Per_Milk_Sales_Mrk_Val: Percentage of Agricultural Income Generated by Milk and Milk products
Per_Cattle_Sales_Mrk_Val: Percentage of Agricultural Income Generated by live cattle sales
Per_Hog_Sales_Mrk_Val: Percentage of Agricultural Income Generated by hog sales
Per_Sheep_Sales_Mrk_Val: Percentage of Agricultural Income Generated by sheep sales
PER_AQ_SALES: Percentage of Agricultural Income Generated by aquaculture sales
PER_EQ_SALES: Percentage of Agricultural Income Generated by equine sales
PER_SP_AN_SALES: Percentage of Agricultural Income Generated by other animal sales
Per_Cropland_Manure: Percentage of Agricultural Land with Manure application
Cattle_Operations: Number of Cattle Operations in the county
Milk_Operations: Number of Milk Operations in the county
Poul_Total_Oper: Number of Poultry Operations in the county
Hog_Oper: Number of Hog Operations in the county
TOT_SHEEP_Oper: Number of sheep Operations in the county
EQUI_OPER: Number of horse Operations in the county
TOT_AQUA_OPER: Number of Aquaculture Operations in the county

In order to visualize this data, we need to merge this database with the shapefile. 

```{r}
ag_data<-merge(counties, NASS2017, by.x='GEOID', by.y='FIPS')


```

## Raster Data

[FAO GLOSIS v 1.5](https://data.apps.fao.org/glosis/?lang=en). 

```{r}

# Read the VRT file as a SpatRaster
FAOGlosis<-rast("FAOGlosisv1.5.tif")
```

```{r}
FAOGlosis
